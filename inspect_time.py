import requests
import os
import click
import getpass
import json

@click.command()
@click.option('--timer', default=1, help='Set timer(in mins) for which you want to run the inspect env')
@click.option('--command', help='Please enter the command you want to run')
def run(timer, command):
    """Simple program to run command"""
    pwd = os.getcwd()
    user = getpass.getuser()
    data = {"command": command, "dir": pwd, "user": user}
    print(data)
    requests.post("http://opensusenetsec.westus2.cloudapp.azure.com:8000/fork_vm", json=data)
    timer = timer * 60
    while timer > 0:
        status = requests.get("http://opensusenetsec.westus2.cloudapp.azure.com:8000/status")
        print(status.text)
        #print(json.dumps(status.text, indent=4, sort_keys=True))
        timer -= 1
if __name__ == '__main__':
    run()
